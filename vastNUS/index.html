<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="TemplateMo">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet">

    <title>vastNUS</title>

    <!-- Bootstrap core CSS -->
    <link href="template/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-host-cloud.css">
    <link rel="stylesheet" href="assets/css/owl.css">

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.0/firebase-database.js"></script>

    <style> 
      .box {
        border-radius: 25px;
        /* border: 1px solid black; */
        background-color: #f4edff;
        padding: 20px;
        margin: 25px;
      }
    </style>

  </head>

  <body>

    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>  
    <!-- ***** Preloader End ***** -->

    <!-- Header -->
    <header class="">
      <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a class="navbar-brand" href="index.html"><h2>vastNUS</h2></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="index.html">Home
                  <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="faculties.html">Faculties</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="matriculation.html">Matriculation</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="forum.html" target="_blank">Forum</a>
              </li>
            </ul>
          <!-- </div>
          <div class="functional-buttons">
            <ul>
              <li><a href="#">Log in</a></li>
              <li><a href="#">Sign Up</a></li>
            </ul>
          </div> -->
        </div>
      </nav>
    </header>

    <!-- Page Content -->
    <!-- Banner Starts Here -->
    <div class="banner">
      <div class="container">
        <div class="row">
          <div class="col-md-8 offset-md-2">
            <div class="header-text caption">
              <h2>Find your ideal course!</h2>
              <div id="search-section">

                <!-- START OF FORM -->
              	<form id="suggestion_form" name="gs" method="get" action="#">
                <div class="searchText">
                  
                  <input type="text" name="q" class="searchText" placeholder="Enter keywords to search for relevant courses..." autocomplete="on" id="searchform">
                  
                  <ul>
                    <!-- SORTING OPTIONS -->
                    <!-- <li style="color:white"><label<form action="/action_page.php">
                      <label for="sortingOptions">Sorted By:</label>
                      <select id="sortingOptions" name="sortingOptions">
                        <option value="Alphabetical">Alphabetical</option>
                        <option value="Relevance">Relevance</option>
                        <option value="Salary">Salary (High to Low)</option>
                      </select>
                    </form></label></li> -->

                    <!-- POLY GPA CUT OFF (gpacutoff)-->
                    <li style="color:white"><form>
                      <label for="quantity">(Poly) GPA: </label>
                      <input type="number" id="gpacutoff" name="gpa" min="0" max="5" step = "0.1">
                    </form></li>
                    
                    <!-- JC IGP (igpcutoff)-->
                    <li style="color:white"><form>
                      <label for="quantity">(JC) IGP: </label>
                      <input type="number" id="igpcutoff" name="igp" min="50" max="90" step = "1.25">
                    </form></li>

                    <!-- MEDIAN SALARY (mediansalary) -->
                    <li style="color:white"><form>
                      <label for="quantity">Median salary: </label>
                      <input type="number" id="mediansalary" name="mediansalary" min="0" max = "100000" step = "100">
                      <!-- input type="submit" -->
                    </form></li>

                  </ul>
                </div>
                    <input type="submit" name="results" class="main-button" value="Search Now" onclick="return submitForm()">
                 </form>
               <div class="advSearch_chkbox">
               </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Banner Ends Here -->

    <!-- Trusted Starts Here --> 
   
    <div class="trusted-section" id="search-results-display"> 
       <!-- THIS WILL BE THE SEARCH DISPLAY -->
    </div>
    <!-- Trusted Ends Here -->



    <!-- Bootstrap core JavaScript -->
    <script src="template/jquery/jquery.min.js"></script>
    <script src="template/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Additional Scripts -->
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/owl.js"></script> 
    <script src="assets/js/accordions.js"></script>


    <script language = "text/Javascript"> 
      cleared[0] = cleared[1] = cleared[2] = 0; //set a cleared flag for each field
      function clearField(t){                   //declaring the array outside of the
      if(! cleared[t.id]){                      // function makes it static and global
          cleared[t.id] = 1;  // you could use true and false, but that's more typing
          t.value='';         // with more chance of typos
          t.style.color='#fff';
          }
      }
    </script>

  </body>

  <script>
    console.log("App loaded");
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = { // JSON (stores info for firebase config)
      apiKey: "AIzaSyCZSmlv2BNeHLmDBt7gF2ZGr1Un-MDOTeA",
      authDomain: "vastnus.firebaseapp.com",
      databaseURL: "https://vastnus-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "vastnus",
      storageBucket: "vastnus.appspot.com",
      messagingSenderId: "462253060608",
      appId: "1:462253060608:web:e7bdd275a258d1e219dee5",
      measurementId: "G-WSL284JJ2D"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    const dbRef = firebase.database().ref(); // Create a reference to the database. Local to this script tag.
    const resultsContainer = document.getElementById("search-results-display");
    //console.log(resultsContainer);

   // Data passed in here shld be a dictionary containing eg faculty name, RpCutOff.... 
   function addResult(data) {
      console.log("Data in addResult");
      console.log(data);

      var box = document.createElement("div");
      box.classList += "box";
      var pageLink = data["link"];
      box.innerHTML = "<h4>" + data["name"] + "</h4>" + "<br/>" 
                      + "<b>" + "Poly GPA: " + data["gpa-CutOff"] + "<br/>"
                      + "JC IGP: " + data["rp-CutOff"] + "<br/>"
                      + "Employment Rate: " + data["emp-rate"] + "<br/>"
                      + "Full Time Employment Rate: " + data["ft-emp-rate"] + "<br/>"
                      + "Median Gross Monthly Salary ($): " + data["median-salary"] + "</b>" + "<br/>" + "<br/>"
                      + data["details"] + "<br/>" + "<br/>" 
                      + "<a href=" + pageLink + " target =" + "_blank>" + pageLink + "</a>"; 
      resultsContainer.appendChild(box);
    }

    // PUSH TO DATABASE HERE
    
    // How to read from database
    // returns state of database at time of retrieval
    // add stuff before then
    function submitForm() {
      resultsContainer.innerHTML = "";
      console.log("Form submitted");

      //var sugg_form = document.getElementById("suggestion_form");
      var gpacutoff = document.getElementById("gpacutoff").value;
      var igpcutoff = document.getElementById("igpcutoff").value;
      var mediansalary = document.getElementById("mediansalary").value;
      var searchform = document.getElementById("searchform").value.toLowerCase();
      console.log(searchform);
     
      dbRef.child("/courses").on("value", (snapshot) => { 
        // var data = snapshot.val();
        // console.log(data["CS2040SBBB"]["name"]);

        var data = snapshot.val();
        console.log(data);
        for (var element in data) {

          // console.log(data[element]);
          // console.log(data[element]["gpa-CutOff"]);
          // console.log(data[element]["rp-CutOff"]);
          // console.log(data[element]["median-salary"]);

          // Check if there is a match w the searchform and keywords
          var keywordmatch = false;
          for (var num in data[element]["keywords"]) {
            if (searchform == data[element]["keywords"][num]) {
              keywordmatch = true;
            }
          }

          if ((gpacutoff == "" || data[element]["gpa-CutOff"] <= gpacutoff) 
              && (igpcutoff == "" || data[element]["rp-CutOff"] <= igpcutoff)
              && (mediansalary == "" || data[element]["median-salary"] >= mediansalary)
              && (searchform == "" || keywordmatch)){
            addResult(data[element]);
          }
        }
      })
    }
    
  </script>

</html>